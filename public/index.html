<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üöÄ Freelancing Platform - IIS Deployment</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
    .status-card { transition: all 0.3s ease; }
    .status-card:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
  </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
  <div class="container mx-auto px-4 py-8">
    <!-- Header -->
    <div class="text-center mb-8">
      <h1 class="text-4xl font-bold text-gray-800 mb-2">
        üöÄ Freelancing Platform
      </h1>
      <p class="text-xl text-gray-600">‚úÖ IIS Deployment Successful!</p>
      <div class="mt-4 inline-block bg-green-100 border border-green-400 text-green-700 px-4 py-2 rounded">
        Server is running on Windows IIS with SQL Server support
      </div>
    </div>

    <!-- Status Grid -->
    <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
      <!-- API Status -->
      <div class="status-card bg-white rounded-lg shadow-md p-6">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-semibold text-gray-700">API Status</h3>
          <div class="w-3 h-3 bg-yellow-400 rounded-full animate-pulse"></div>
        </div>
        <p id="api-status" class="text-yellow-600">Testing...</p>
        <p class="text-sm text-gray-500 mt-2">REST API endpoints</p>
      </div>

      <!-- Database Status -->
      <div class="status-card bg-white rounded-lg shadow-md p-6">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-semibold text-gray-700">Database</h3>
          <div class="w-3 h-3 bg-yellow-400 rounded-full animate-pulse"></div>
        </div>
        <p id="db-status" class="text-yellow-600">Testing...</p>
        <p class="text-sm text-gray-500 mt-2">SQL Server connection</p>
      </div>

      <!-- Authentication -->
      <div class="status-card bg-white rounded-lg shadow-md p-6">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-semibold text-gray-700">Authentication</h3>
          <div class="w-3 h-3 bg-yellow-400 rounded-full animate-pulse"></div>
        </div>
        <p id="auth-status" class="text-yellow-600">Testing...</p>
        <p class="text-sm text-gray-500 mt-2">Replit Auth integration</p>
      </div>

      <!-- Server Health -->
      <div class="status-card bg-white rounded-lg shadow-md p-6">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-semibold text-gray-700">Server Health</h3>
          <div class="w-3 h-3 bg-yellow-400 rounded-full animate-pulse"></div>
        </div>
        <p id="health-status" class="text-yellow-600">Testing...</p>
        <p class="text-sm text-gray-500 mt-2">System performance</p>
      </div>
    </div>

    <!-- Detailed Status -->
    <div class="bg-white rounded-lg shadow-md p-6 mb-8">
      <h3 class="text-xl font-semibold text-gray-800 mb-4">System Status</h3>
      <div id="status" class="text-gray-600">
        Initializing system diagnostics...
      </div>
    </div>

    <!-- API Testing Panel -->
    <div class="bg-white rounded-lg shadow-md p-6 mb-8">
      <h3 class="text-xl font-semibold text-gray-800 mb-4">API Testing</h3>
      <div class="space-y-4">
        <div class="flex flex-wrap gap-2">
          <button onclick="testEndpoint('/api/test')" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded transition-colors">
            Test API
          </button>
          <button onclick="testEndpoint('/api/health')" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded transition-colors">
            Health Check
          </button>
          <button onclick="testEndpoint('/api/jobs')" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded transition-colors">
            Jobs Endpoint
          </button>
          <button onclick="testEndpoint('/api/auth/user')" class="bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded transition-colors">
            Auth Test
          </button>
        </div>
        <div id="api-test-results" class="bg-gray-50 rounded p-4 min-h-20">
          <p class="text-gray-500">Click buttons above to test API endpoints</p>
        </div>
      </div>
    </div>

    <!-- Configuration Info -->
    <div class="bg-white rounded-lg shadow-md p-6">
      <h3 class="text-xl font-semibold text-gray-800 mb-4">Deployment Configuration</h3>
      <div class="grid md:grid-cols-2 gap-6">
        <div>
          <h4 class="font-medium text-gray-700 mb-2">Server Details</h4>
          <ul class="text-sm text-gray-600 space-y-1">
            <li>‚Ä¢ Platform: Windows IIS</li>
            <li>‚Ä¢ Runtime: Node.js via iisnode</li>
            <li>‚Ä¢ Environment: Production</li>
            <li>‚Ä¢ Frontend: React SPA</li>
          </ul>
        </div>
        <div>
          <h4 class="font-medium text-gray-700 mb-2">Database Configuration</h4>
          <ul class="text-sm text-gray-600 space-y-1">
            <li>‚Ä¢ Type: SQL Server Express</li>
            <li>‚Ä¢ Host: DESKTOP-3GN7HPO\\SQLEXPRESS</li>
            <li>‚Ä¢ Database: FreelancingPlatform</li>
            <li>‚Ä¢ Port: 1433</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <script>
    async function initializeApp() {
      const status = document.getElementById('status');
      const apiStatus = document.getElementById('api-status');
      const dbStatus = document.getElementById('db-status');
      const authStatus = document.getElementById('auth-status');
      const healthStatus = document.getElementById('health-status');

      try {
        // Test health endpoint first
        const healthResponse = await fetch('/api/health');
        if (healthResponse.ok) {
          const healthData = await healthResponse.json();
          healthStatus.textContent = `Healthy (${healthData.environment})`;
          healthStatus.className = 'text-green-600';
        }

        // Test API connectivity
        const apiResponse = await fetch('/api/jobs');
        console.log('API Response Status:', apiResponse.status);
        
        if (apiResponse.ok) {
          const contentType = apiResponse.headers.get('content-type');
          
          if (contentType && contentType.includes('application/json')) {
            const data = await apiResponse.json();
            apiStatus.textContent = 'Connected';
            apiStatus.className = 'text-green-600';
            dbStatus.textContent = data.database || 'Connected';
            dbStatus.className = 'text-green-600';
          } else {
            const text = await apiResponse.text();
            console.log('Non-JSON response:', text.substring(0, 200));
            apiStatus.textContent = 'Returns HTML instead of JSON';
            apiStatus.className = 'text-red-600';
            dbStatus.textContent = 'API routing issue';
            dbStatus.className = 'text-red-600';
          }
        } else {
          apiStatus.textContent = `Error ${apiResponse.status}`;
          apiStatus.className = 'text-red-600';
          dbStatus.textContent = 'Cannot connect';
          dbStatus.className = 'text-red-600';
        }

        // Test authentication
        const authResponse = await fetch('/api/auth/user');
        if (authResponse.status === 401) {
          authStatus.textContent = 'Not logged in (expected)';
          authStatus.className = 'text-yellow-600';
        } else if (authResponse.ok) {
          authStatus.textContent = 'Authenticated';
          authStatus.className = 'text-green-600';
        } else {
          authStatus.textContent = 'Auth error';
          authStatus.className = 'text-red-600';
        }

        status.innerHTML = '<p class="text-green-600">‚úÖ System initialization complete. All core services tested.</p>';
        
      } catch (error) {
        console.error('Initialization error:', error);
        status.innerHTML = '<p class="text-red-600">‚ùå Network error. Check server configuration and console logs.</p>';
        apiStatus.textContent = 'Connection failed';
        apiStatus.className = 'text-red-600';
        dbStatus.textContent = 'Cannot test';
        dbStatus.className = 'text-red-600';
        authStatus.textContent = 'Cannot test';
        authStatus.className = 'text-red-600';
        healthStatus.textContent = 'Unhealthy';
        healthStatus.className = 'text-red-600';
      }
    }

    async function testEndpoint(endpoint) {
      const resultsDiv = document.getElementById('api-test-results');
      resultsDiv.innerHTML = '<p class="text-blue-600">Testing ' + endpoint + '...</p>';
      
      try {
        const response = await fetch(endpoint);
        const contentType = response.headers.get('content-type');
        let data;
        
        if (contentType && contentType.includes('application/json')) {
          data = await response.json();
        } else {
          data = await response.text();
        }
        
        resultsDiv.innerHTML = `
          <div class="space-y-2">
            <div class="flex items-center gap-2">
              <span class="font-medium">Status:</span>
              <span class="${response.ok ? 'text-green-600' : 'text-red-600'}">${response.status}</span>
            </div>
            <div>
              <span class="font-medium">Response:</span>
              <pre class="bg-gray-100 p-2 rounded mt-1 text-xs overflow-auto">${JSON.stringify(data, null, 2)}</pre>
            </div>
          </div>
        `;
      } catch (error) {
        resultsDiv.innerHTML = `<p class="text-red-600">Error: ${error.message}</p>`;
      }
    }

    // Initialize when page loads
    document.addEventListener('DOMContentLoaded', initializeApp);
  </script>
</body>
</html>