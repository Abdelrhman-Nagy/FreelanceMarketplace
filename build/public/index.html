<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Freelancing Platform - Production Build</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
    .status-card { transition: all 0.3s ease; }
    .status-card:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
    .spinner { animation: spin 2s linear infinite; }
    @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
  </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
  <div class="container mx-auto px-4 py-8">
    <!-- Header -->
    <div class="text-center mb-8">
      <h1 class="text-4xl font-bold text-gray-800 mb-2">
        Freelancing Platform
      </h1>
      <p class="text-xl text-gray-600">Production Build - IIS + SQL Server</p>
      <div class="mt-4 inline-block bg-blue-100 border border-blue-400 text-blue-700 px-4 py-2 rounded">
        Ready for production deployment
      </div>
    </div>

    <!-- Status Grid -->
    <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
      <!-- API Status -->
      <div class="status-card bg-white rounded-lg shadow-md p-6">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-semibold text-gray-700">API Status</h3>
          <div id="api-indicator" class="w-3 h-3 bg-yellow-400 rounded-full spinner"></div>
        </div>
        <p id="api-status" class="text-yellow-600">Testing...</p>
        <p class="text-sm text-gray-500 mt-2">REST API endpoints</p>
      </div>

      <!-- Database Status -->
      <div class="status-card bg-white rounded-lg shadow-md p-6">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-semibold text-gray-700">SQL Server</h3>
          <div id="db-indicator" class="w-3 h-3 bg-yellow-400 rounded-full spinner"></div>
        </div>
        <p id="db-status" class="text-yellow-600">Connecting...</p>
        <p class="text-sm text-gray-500 mt-2">Database connection</p>
      </div>

      <!-- Data Statistics -->
      <div class="status-card bg-white rounded-lg shadow-md p-6">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-semibold text-gray-700">Database Stats</h3>
          <div id="stats-indicator" class="w-3 h-3 bg-yellow-400 rounded-full spinner"></div>
        </div>
        <p id="stats-status" class="text-yellow-600">Loading...</p>
        <p class="text-sm text-gray-500 mt-2">Records count</p>
      </div>

      <!-- Server Health -->
      <div class="status-card bg-white rounded-lg shadow-md p-6">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-semibold text-gray-700">Server Health</h3>
          <div id="health-indicator" class="w-3 h-3 bg-yellow-400 rounded-full spinner"></div>
        </div>
        <p id="health-status" class="text-yellow-600">Checking...</p>
        <p class="text-sm text-gray-500 mt-2">System performance</p>
      </div>
    </div>

    <!-- API Testing Panel -->
    <div class="bg-white rounded-lg shadow-md p-6 mb-8">
      <h3 class="text-xl font-semibold text-gray-800 mb-4">API Testing Panel</h3>
      <div class="space-y-4">
        <div class="flex flex-wrap gap-2">
          <button onclick="testEndpoint('/api/health')" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded transition-colors">
            Health Check
          </button>
          <button onclick="testEndpoint('/api/test')" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded transition-colors">
            API Test
          </button>
          <button onclick="testEndpoint('/api/users')" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded transition-colors">
            Users Data
          </button>
          <button onclick="testEndpoint('/api/jobs')" class="bg-indigo-500 hover:bg-indigo-600 text-white px-4 py-2 rounded transition-colors">
            Jobs Data
          </button>
          <button onclick="testEndpoint('/api/proposals')" class="bg-pink-500 hover:bg-pink-600 text-white px-4 py-2 rounded transition-colors">
            Proposals Data
          </button>
          <button onclick="testEndpoint('/api/stats')" class="bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded transition-colors">
            Statistics
          </button>
        </div>
        <div id="api-test-results" class="bg-gray-50 rounded p-4 min-h-20">
          <p class="text-gray-500">Click buttons above to test SQL Server integration</p>
        </div>
      </div>
    </div>

    <!-- Database Information -->
    <div class="bg-white rounded-lg shadow-md p-6 mb-8">
      <h3 class="text-xl font-semibold text-gray-800 mb-4">Database Configuration</h3>
      <div class="grid md:grid-cols-2 gap-6">
        <div>
          <h4 class="font-medium text-gray-700 mb-2">Connection Details</h4>
          <ul class="text-sm text-gray-600 space-y-1">
            <li>• Server: DESKTOP-3GN7HPO\SQLEXPRESS</li>
            <li>• Database: FreelancingPlatform</li>
            <li>• Port: 1433</li>
            <li>• Driver: mssql (Node.js)</li>
          </ul>
        </div>
        <div>
          <h4 class="font-medium text-gray-700 mb-2">Available Endpoints</h4>
          <ul class="text-sm text-gray-600 space-y-1">
            <li>• GET /api/users - User records</li>
            <li>• GET /api/jobs - Job listings</li>
            <li>• POST /api/jobs - Create new job</li>
            <li>• GET /api/proposals - Proposals data</li>
            <li>• GET /api/stats - Database statistics</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Deployment Info -->
    <div class="bg-white rounded-lg shadow-md p-6">
      <h3 class="text-xl font-semibold text-gray-800 mb-4">Deployment Information</h3>
      <div class="grid md:grid-cols-3 gap-6">
        <div>
          <h4 class="font-medium text-gray-700 mb-2">Platform</h4>
          <ul class="text-sm text-gray-600 space-y-1">
            <li>• Windows IIS</li>
            <li>• Node.js via iisnode</li>
            <li>• Express.js framework</li>
            <li>• Production ready</li>
          </ul>
        </div>
        <div>
          <h4 class="font-medium text-gray-700 mb-2">Features</h4>
          <ul class="text-sm text-gray-600 space-y-1">
            <li>• SQL Server integration</li>
            <li>• RESTful API endpoints</li>
            <li>• Error handling</li>
            <li>• CORS enabled</li>
          </ul>
        </div>
        <div>
          <h4 class="font-medium text-gray-700 mb-2">Dependencies</h4>
          <ul class="text-sm text-gray-600 space-y-1">
            <li>• express ^4.18.2</li>
            <li>• mssql ^10.0.1</li>
            <li>• cors ^2.8.5</li>
            <li>• Node.js 16+</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <script>
    async function initializeApp() {
      const indicators = {
        api: document.getElementById('api-indicator'),
        db: document.getElementById('db-indicator'),
        stats: document.getElementById('stats-indicator'),
        health: document.getElementById('health-indicator')
      };

      const statuses = {
        api: document.getElementById('api-status'),
        db: document.getElementById('db-status'),
        stats: document.getElementById('stats-status'),
        health: document.getElementById('health-status')
      };

      function setStatus(type, status, message, color) {
        statuses[type].textContent = message;
        statuses[type].className = `text-${color}-600`;
        indicators[type].className = `w-3 h-3 bg-${color}-400 rounded-full`;
      }

      try {
        // Test health endpoint
        const healthResponse = await fetch('/api/health');
        if (healthResponse.ok) {
          const healthData = await healthResponse.json();
          setStatus('health', 'success', `${healthData.status} (v${healthData.version})`, 'green');
          setStatus('api', 'success', 'Connected', 'green');
          
          if (healthData.database === 'Connected') {
            setStatus('db', 'success', 'SQL Server Connected', 'green');
          } else {
            setStatus('db', 'warning', 'Database Disconnected', 'red');
          }
        } else {
          setStatus('health', 'error', 'Service Unavailable', 'red');
          setStatus('api', 'error', 'API Error', 'red');
        }

        // Test database statistics
        const statsResponse = await fetch('/api/stats');
        if (statsResponse.ok) {
          const statsData = await statsResponse.json();
          setStatus('stats', 'success', `${statsData.totalUsers} users, ${statsData.totalJobs} jobs`, 'green');
        } else {
          setStatus('stats', 'warning', 'Stats unavailable', 'yellow');
        }

      } catch (error) {
        console.error('Initialization error:', error);
        setStatus('health', 'error', 'Connection failed', 'red');
        setStatus('api', 'error', 'Network error', 'red');
        setStatus('db', 'error', 'Cannot connect', 'red');
        setStatus('stats', 'error', 'Cannot load', 'red');
      }
    }

    async function testEndpoint(endpoint) {
      const resultsDiv = document.getElementById('api-test-results');
      resultsDiv.innerHTML = '<p class="text-blue-600">Testing ' + endpoint + '...</p>';
      
      try {
        const start = performance.now();
        const response = await fetch(endpoint);
        const end = performance.now();
        const duration = Math.round(end - start);
        
        const contentType = response.headers.get('content-type');
        let data;
        
        if (contentType && contentType.includes('application/json')) {
          data = await response.json();
        } else {
          data = await response.text();
        }
        
        resultsDiv.innerHTML = `
          <div class="space-y-3">
            <div class="flex items-center gap-4">
              <span class="font-medium">Endpoint:</span>
              <span class="font-mono text-sm bg-gray-200 px-2 py-1 rounded">${endpoint}</span>
              <span class="font-medium">Status:</span>
              <span class="${response.ok ? 'text-green-600' : 'text-red-600'} font-medium">${response.status}</span>
              <span class="text-gray-500">(${duration}ms)</span>
            </div>
            <div>
              <span class="font-medium">Response:</span>
              <pre class="bg-gray-100 p-3 rounded mt-2 text-xs overflow-auto max-h-64">${JSON.stringify(data, null, 2)}</pre>
            </div>
          </div>
        `;
      } catch (error) {
        resultsDiv.innerHTML = `
          <div class="text-red-600">
            <p class="font-medium">Error testing ${endpoint}:</p>
            <p class="text-sm mt-1">${error.message}</p>
          </div>
        `;
      }
    }

    // Initialize when page loads
    document.addEventListener('DOMContentLoaded', initializeApp);
  </script>
</body>
</html>